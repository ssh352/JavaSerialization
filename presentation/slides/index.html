<!doctype html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Serialisering av data - et løst problem?</title>
    <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.min.css">
    <link rel="stylesheet" href="bower_components/reveal.js/css/theme/moon.css" id="theme">

</head>
<body>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to
    improve your experience.</p>
<![endif]-->
<div class="reveal">
    <div class="slides">


        <section data-markdown>
            <script type="text/template">
                ##  Serialisering av data - et løst problem?
                Tom Chrisitian Woods
                Knowit Sør
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
                ## Oversikt
                * Hva er serialisering ?
                * Serialisering med Java
                    * Serializable
                    * Externalizable
                    * Versjonering
                    * Ytelse
                * Andre serialiserings bibliotek/verktøy
                    * Uten kildekode generering
                        * Kryo
                        * Jackson
                        * Messagepack
                    * Med kildekode generering
                        * Avro
                        * Protocol Buffers
                        * SBE
                * Benchmarks
                * Konklusjon
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
            ## Hva er serialisering ?
            </script>
        </section>
        <section>
            <h2>Serialisering</h2>
            Prosessen å oversette en datastruktur eller objekttilstand til et format som kan bli lagret/sendt
            for så å bli rekonstruert identisk på samme eller annen maskin/miljø.
        </section>
        <section data-markdown>
            <script type="text/template">
            ##Serialisering stikkord
* Endianness (Java big-endian, x86 little-endian)
* Bytepacking
* Swizzling/Unswizzling (Ikke lurt å serialisere Thread i Java)
* Versjonering
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
            ##Serialisering med Java
            </script>
        </section>
        <section>
            <h2>Serializable</h2>
    <pre>
        <code data-trim class="java">
            public class Employee implements Serializable {

            private static final long serialVersionUID = 1L;

            private long employeeId;
            private double salery;
            private boolean consultant;
            private String employeeName;
            private List&lt;String&gt; departments;
            ...

            }
        </code>
    </pre>
        </section>

        <section>
            <h2>Serializable</h2>
                <pre>
        <code data-trim class="java">
            private void writeObject(ObjectOutputStream stream) throws IOException;
        </code>
    </pre>
    <pre>
        <code data-trim class="java">
            private void readObject(ObjectInputStream stream)throws IOException,
                                             ClassNotFoundException;
        </code>
    </pre>
        </section>
        <section>
            <h2>Custom writeObject/readObject</h2>
    <pre>
        <code data-trim class="java">
private String name;
private transient String note;

private void writeObject(ObjectOutputStream out) throws IOException {
out.defaultWriteObject();
out.writeObject(this.note);
}

private void readObject(ObjectInputStream in) throws IOException,
                                          ClassNotFoundException {
in.defaultReadObject();
this.note = (String) in.readObject();
}
        </code>
    </pre>
        </section>

        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
ByteArrayOutputStream bos = new ByteArrayOutputStream();
try (ObjectOutputStream os = new ObjectOutputStream(bos)){
    os.writeObject(objekt);
}
byte[] bytes = bos.toByteArray();
        </code>
    </pre>

                 <pre>
        <code data-trim class="java">
ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
try (ObjectInputStream objectInputStream = new ObjectInputStream(bis)){
    Objekt objekt = (Objekt) objectInputStream.readObject();
}
        </code>
    </pre>
        </section>
<section data-markdown>
    <script type="text/template">
        ## writeObject i korte trekk
        * Objectet må selv ha eller arve fra et object som implementer serializable og har en tilgjengelig tom konstuktør.
        * writeObject blir kalt rekursivt fra løvnode til høyest forelder som fyller kriterene for å være serialiserbar
        * Alle felt som er ikke transient eller static blir tatt med
        * Hvis ikke Objectet/ene har serialVersionUID blir en 64-bits hash kalkulert
        * NB! Bruker Refleksjon
    </script>
</section>

        <section>
            <h2>Externalizable</h2>
    <pre>
        <code data-trim class="java">
            public class Employee implements Externalizable {

            private static final long serialVersionUID = 1L;

            private long employeeId;
            private double salery;
            private boolean consultant;
            private String employeeName;
            private List&lt;String&gt; departments;
            ...
        </code>
    </pre>

        </section>
        <section>
            <h2>Externalizable</h2>
                <pre>
        <code data-trim class="java">
            public void writeExternal(ObjectOutput out) throws IOException {
            out.writeLong(employeeId);
            out.writeDouble(salery);
            out.writeBoolean(consultant);
            out.writeObject(employeeName);
            out.writeObject(departments);
            }
        </code>
    </pre>
    <pre>
        <code data-trim class="java">
            public void readExternal(ObjectInput in) throws IOException,
            ClassNotFoundException {
            employeeId = in.readLong();
            salery = in.readDouble();
            consultant = in.readBoolean();
            employeeName = (String) in.readObject();
            departments = (List&lt;String&gt;) in.readObject();
            }
        </code>
    </pre>
        </section>

        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
ByteArrayOutputStream bos = new ByteArrayOutputStream();
try (ObjectOutputStream os = new ObjectOutputStream(bos)){
os.writeExternal(objekt);
}
byte[] bytes = bos.toByteArray();
        </code>
    </pre>

                 <pre>
        <code data-trim class="java">
ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
try (ObjectInputStream objectInputStream = new ObjectInputStream(bis)){
Objekt objekt = (Objekt) objectInputStream.readExternal();
}
        </code>
    </pre>
        </section>

        <section data-markdown>
            <script type="text/template">
            ## Versjonering
            </script>
        </section>
        <section>
            <h2>Versjonering</h2>
            I det et objekt blir brukt til serialisering må det behandles
            på samme måte som et public api
        </section>
        <section>
            <h2>serialVersionUID og serialver</h2>
              <pre>
        <code data-trim class="java">
public class Employee implements Serializable {

    private static final long serialVersionUID = 1L;

    ...
}
        </code>
    </pre>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##  Ikke brytende endringer
                * Legge til felt
                * Legge til klasse
                * Fjerne klasse
                * Legge til writeObject/readObject
                * Legge til java.io.Serializable
                * Endre felt tilgang (public, package, protected og private)
                * Endre et felt fra static til nonstatic eller transient til nontransient
            </script>
        </section>
        <section>
            <h2>Ytelse</h2>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##  Benchmarking
                * Hardware
                * Hvilken type data (stor vs lite objekt graf)
                * Innholder collection typer
                * Ekvivalent representasjon (Versjon data osv.)
                * GC forurensing (Java)
                * Ulike optimaliseringer
            </script>
        </section>

        <section>
            <h2>TEST DATA</h2>
                <pre>
        <code data-trim class="java">
long employeeId = 1234567891011; <- inc 1
double salery = 123456.12;
boolean consultant = true;
String employeeName = "John Doe";
List&lt;String&gt; departments = ["IT", "RD", "TECH"];
        </code>
    </pre>
    </section>
        <section>
            <h3>Serializable</h3>
            <h4>243 bytes</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 73 72 00 13 74 63 77 2E 64 6F 6D 61
            69 6E 2E 45 6D 70 6C 6F 79 65 65 00 00 00 00 00
            00 00 01 02 00 05 5A 00 0A 63 6F 6E 73 75 6C 74
            61 6E 74 4A 00 0A 65 6D 70 6C 6F 79 65 65 49 64
            44 00 06 73 61 6C 65 72 79 4C 00 0B 64 65 70 61
            72 74 6D 65 6E 74 73 74 00 10 4C 6A 61 76 61 2F
            75 74 69 6C 2F 4C 69 73 74 3B 4C 00 0C 65 6D 70
            6C 6F 79 65 65 4E 61 6D 65 74 00 12 4C 6A 61 76
            61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3B 78 70
            01 00 00 01 1F 71 FB 08 43 40 FE 24 01 EB 85 1E
            B8 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E 41
            72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61 9D
            03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00 03
            77 04 00 00 00 03 74 00 02 49 54 74 00 02 52 44
            74 00 04 54 45 43 48 78 74 00 08 4A 6F 68 6E 20
            44 6F 65
            </div>
        </section>

        <section>
            <h3>Serializable</h3>
            <h4>303 bytes - men bare 60 nye</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 73 72 00 13 74 63 77 2E 64 6F 6D 61
            69 6E 2E 45 6D 70 6C 6F 79 65 65 00 00 00 00 00
            00 00 01 02 00 05 5A 00 0A 63 6F 6E 73 75 6C 74
            61 6E 74 4A 00 0A 65 6D 70 6C 6F 79 65 65 49 64
            44 00 06 73 61 6C 65 72 79 4C 00 0B 64 65 70 61
            72 74 6D 65 6E 74 73 74 00 10 4C 6A 61 76 61 2F
            75 74 69 6C 2F 4C 69 73 74 3B 4C 00 0C 65 6D 70
            6C 6F 79 65 65 4E 61 6D 65 74 00 12 4C 6A 61 76
            61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3B 78 70
            01 00 00 01 1F 71 FB 08 43 40 FE 24 01 EB 85 1E
            B8 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E 41
            72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61 9D
            03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00 03
            77 04 00 00 00 03 74 00 02 49 54 74 00 02 52 44
            74 00 04 54 45 43 48 78 74 00 08 4A 6F 68 6E 20
            44 6F 65 <span style="color: red">73 71 00 7E 00 00 01 00 00 01 1F 71 FB
            08 44 40 FE 24 01 EB 85 1E B8 73 71 00 7E 00 04
            00 00 00 03 77 04 00 00 00 03 71 00 7E 00 06 71
            00 7E 00 07 71 00 7E 00 08 78 71 00 7E 00 09</span>
            </div>
        </section>

        <section>
            <h3>Externalizable</h3>
            <h4>105 bytes</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 77 11 00 00 01 1F 71 FB 08 43 40 FE
            24 01 EB 85 1E B8 01 74 00 08 4A 6F 68 6E 20 44
            6F 65 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E
            41 72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61
            9D 03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00
            03 77 04 00 00 00 03 74 00 02 49 54 74 00 02 52
            44 74 00 04 54 45 43 48 78
        </div>
        </section>
        <section>
            <h3>Externalizable</h3>
            <h4>161 bytes - men bare 56 nye</h4>
            <div style="text-align: left;color: #f5e810">
                AC ED 00 05 77 11 00 00 01 1F 71 FB 08 43 40 FE
                24 01 EB 85 1E B8 01 74 00 08 4A 6F 68 6E 20 44
                6F 65 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E
                41 72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61
                9D 03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00
                03 77 04 00 00 00 03 74 00 02 49 54 74 00 02 52
                44 74 00 04 54 45 43 48 78 <span style="color: red">77 11 00 00 01 1F 71
                FB 08 44 40 FE 24 01 EB 85 1E B8 01 71 00 7E 00
                00 73 71 00 7E 00 01 00 00 00 03 77 04 00 00 00
                03 71 00 7E 00 03 71 00 7E 00 04 71 00 7E 00 05
                78
                </span>
            </div>
        </section>
        <section>
            <img src="img/kryo-logo.jpg" style="border-style: none">
        </section>
        <section>
            <h2>Kryo</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>Java</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Fra kode</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>TaggedFieldSerializer og CompatibleFieldSerializer</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>Binært</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Særdeles bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Meget bra</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Enkelt og konfigurerbart</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Kun for Java</td>
                </tr>
            </table>
        </section>
        <section data-markdown>
            <script type="text/template">
                ## Litt mer om Kryo
                * Tilbyr UNSAFE
                * Bruker bytecode generation (ReflectASM)
                * Mange optimaliseringer (Store objekt grafer)
            </script>
        </section>
        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
Kryo kryo = new Kryo();
ByteArrayOutputStream bos = new ByteArrayOutputStream();
try (Output output = new Output(bos)){
    kryo.writeObject(output, Objekt.class);
}
byte[] bytes = bos.toByteArray();
        </code>
    </pre>

                 <pre>
        <code data-trim class="java">
Kryo kryo = new Kryo();
ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
try (Input input = new Input(bis)){
    Objekt objekt = kryo.readObject(input,clazz);
}
        </code>
    </pre>
        </section>
        <section>
            <h3>Kryo</h3>
            <h4>59 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                01 01 01 00 6A 61 76 61 2E 75 74 69 6C 2E 41 72
                72 61 79 4C 69 73 F4 01 03 01 49 D4 01 52 C4 01
                54 45 43 C8 86 A1 D8 9F EE 47 01 4A 6F 68 6E 20
                44 6F E5 40 FE 24 01 EB 85 1E B8
            </div>
        </section>
        <section>
            <h2>Jackson</h2>
        </section>
        <section>
            <h2>Jackson</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>Alle som kan parse JSON</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Fra kode</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>Ingen</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>JSON</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Særdeles bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Bra</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Internet vennlig og lesbart</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Ytelse og størrelse</td>
                </tr>
            </table>
        </section>
        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
ObjectMapper mapper = new ObjectMapper();
byte[] bytes = mapper.writeValueAsBytes(objekt);
        </code>
    </pre>

                 <pre>
        <code data-trim class="java">
ObjectMapper mapper = new ObjectMapper();
Objekt objekt = mapper.readValue(bytes, Objekt.class);
        </code>
    </pre>
        </section>
        <section>
            <h3>Jackson</h3>
            <h4>124 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                7B 22 65 6D 70 6C 6F 79 65 65 49 64 22 3A 31 32
                33 34 35 36 37 38 39 31 30 31 31 2C 22 73 61 6C
                65 72 79 22 3A 31 32 33 34 35 36 2E 31 32 2C 22
                63 6F 6E 73 75 6C 74 61 6E 74 22 3A 74 72 75 65
                2C 22 65 6D 70 6C 6F 79 65 65 4E 61 6D 65 22 3A
                22 4A 6F 68 6E 20 44 6F 65 22 2C 22 64 65 70 61
                72 74 6D 65 6E 74 73 22 3A 5B 22 49 54 22 2C 22
                52 44 22 2C 22 54 45 43 48 22 5D 7D
            </div>
        </section>
        <section>
            <img src="img/messagepack.png" style="border-style: none">
        </section>
        <section>
            <h2>Messagepack</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>28 språk</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Fra kode</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>Ingen nå</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>Binært</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Meget bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Bra - Men må gjøres manuelt</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Kompakt og støttet av mange språk</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Ytelse i java hvis annoteringer blir brukt</td>
                </tr>
            </table>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##Litt mer om Messagepack
                * En binær json representasjon
                * Ikke bruk java annotasjonen
            </script>
        </section>
        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
MessagePack msgpack = new MessagePack()
byte[] bytes = msgpack.write(objekt)
        </code>
    </pre>
                 <pre>
        <code data-trim class="java">
MessagePack msgpack = new MessagePack()
Objekt objekt = msgpack.read(bytes, Objekt.class);
        </code>
    </pre>
        </section>
        <section>
            <h3>Messagepack</h3>
            <h4>40 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                CF 00 00 01 1F 71 FB 08 43 CB 40 FE 24 01 EB 85
                1E B8 C3 A8 4A 6F 68 6E 20 44 6F 65 93 A2 49 54
                A2 52 44 A4 54 45 43 48
            </div>
        </section>
        <section>
            <img src="img/avro-logo.png" style="border-style: none">
        </section>
        <section>
            <h2>Avro</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>Java,C/C++,C#,Python</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Kode generering fra json skjema</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>Tja, Union og default verdier</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>Binært</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Bra</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Skjema blir serialiset med beskjeden - Passer til dynamiske språk</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Dokumentasjon og ytelse</td>
                </tr>
            </table>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##Litt mer om Avro
                * Brukes i Apache Hadoop
                * Hele skjemaet er med i meldingen
                * Kan validere data i runtime
                * Passer til dynamiske språk
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##Kildekode generering
                * Opprett en *.avsc (json) fil under src/main/avro
                * Legg til avro-maven-plugin i pom'en
            </script>
        </section>
        <section>
            <h2>employee.avsc</h2>
             <pre>
        <code data-trim class="javascript">
{"namespace": "tcw.domain.avro.java",
    "type": "record",
    "name": "Employee",
    "fields": [
    {
    "name": "employeeId",
    "type": ["long", "null"]
    },
    {
    "name": "salery",
    "type": ["double", "null"]
    },
    {
    "name": "consultant",
    "type": ["boolean", "null"]
    },
    {
    "name": "employeeName",
    "type": ["string", "null"]
    },
    {
    "name": "departments",
    "type": "array",
    "type":["null",
    {
    "type":"array",
    "items":"string"
    }
    ],
    "default":null
    }
]
}
        </code>
    </pre>
        </section>

            <section>
        <h2>Domene Objekter</h2>
         <pre>
        <code data-trim class="java">
User user1 = new User();
user1.setName("Alyssa");
user1.setFavoriteNumber(256);
        </code>
    </pre>

        <pre>
        <code data-trim class="java">
User user2 = new User("Ben", 7, "red");
        </code>
    </pre>
        <pre>
        <code data-trim class="java">
User user3 = User.newBuilder()
.setName("Charlie")
.setFavoriteColor("blue")
.setFavoriteNumber(null)
.build();
        </code>
    </pre>
</section>

        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
DatumWriter&lt;Objekt&gt; userDatumWriter = new SpecificDatumWriter&lt;&gt;(Objekt.class);
ByteArrayOutputStream bos = new ByteArrayOutputStream();
try (DataFileWriter&lt;Objekt&gt; dataFileWriter = new DataFileWriter&lt;&gt;(userDatumWriter)) {
    try (DataFileWriter&lt;Objekt&gt; writer = dataFileWriter.create(objekt.getSchema(), bos)) {
        writer.append(objekt);
    }
}
byte[] bytes = bos.toByteArray();
        </code>
    </pre>
                 <pre>
        <code data-trim class="java">
DatumReader&lt;Objekt&gt; userDatumReader = new SpecificDatumReader&lt;&gt;(Employee.class);
SeekableByteArrayInput sbai = new SeekableByteArrayInput(bytes);
try (DataFileReader&lt;Objekt&gt; dataFileReader = new DataFileReader&lt;&gt;(sbai, userDatumReader)) {
    Employee deserialized = dataFileReader.next();
}
        </code>
    </pre>
        </section>
        <section>
            <h3>Avro</h3>
            <h4>450 bytes</h4>
            <div style="text-align: left;color: #f5e810; font-size: x-large">
                4F 62 6A 01 02 16 61 76 72 6F 2E 73 63 68 65 6D
                61 C4 05 7B 22 74 79 70 65 22 3A 22 72 65 63 6F
                72 64 22 2C 22 6E 61 6D 65 22 3A 22 45 6D 70 6C
                6F 79 65 65 22 2C 22 6E 61 6D 65 73 70 61 63 65
                22 3A 22 74 63 77 2E 64 6F 6D 61 69 6E 2E 61 76
                72 6F 2E 6A 61 76 61 22 2C 22 66 69 65 6C 64 73
                22 3A 5B 7B 22 6E 61 6D 65 22 3A 22 65 6D 70 6C
                6F 79 65 65 49 64 22 2C 22 74 79 70 65 22 3A 5B
                22 6C 6F 6E 67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C
                7B 22 6E 61 6D 65 22 3A 22 73 61 6C 65 72 79 22
                2C 22 74 79 70 65 22 3A 5B 22 64 6F 75 62 6C 65
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 63 6F 6E 73 75 6C 74 61 6E 74 22 2C
                22 74 79 70 65 22 3A 5B 22 62 6F 6F 6C 65 61 6E
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 65 6D 70 6C 6F 79 65 65 4E 61 6D 65
                22 2C 22 74 79 70 65 22 3A 5B 22 73 74 72 69 6E
                67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61
                6D 65 22 3A 22 64 65 70 61 72 74 6D 65 6E 74 73
                22 2C 22 74 79 70 65 22 3A 5B 22 6E 75 6C 6C 22
                2C 7B 22 74 79 70 65 22 3A 22 61 72 72 61 79 22
                2C 22 69 74 65 6D 73 22 3A 22 73 74 72 69 6E 67
                22 7D 5D 2C 22 64 65 66 61 75 6C 74 22 3A 6E 75
                6C 6C 7D 5D 7D 00 D8 DB 56 32 A1 95 ED F0 6A 5A
                6E 6D A8 C5 6C C0 02 54 00 86 A1 D8 9F EE 47 00
                B8 1E 85 EB 01 24 FE 40 00 01 00 10 4A 6F 68 6E
                20 44 6F 65 02 06 04 49 54 04 52 44 08 54 45 43
                48 00 D8 DB 56 32 A1 95 ED F0 6A 5A 6E 6D A8 C5
                6C C0
            </div>
        </section>
        <section>
            <h3>Avro</h3>
            <h4>493 bytes - men bare 43 nye og 42 etter dette</h4>
            <div style="text-align: left;color: #f5e810; font-size: x-large">
                4F 62 6A 01 02 16 61 76 72 6F 2E 73 63 68 65 6D
                61 C4 05 7B 22 74 79 70 65 22 3A 22 72 65 63 6F
                72 64 22 2C 22 6E 61 6D 65 22 3A 22 45 6D 70 6C
                6F 79 65 65 22 2C 22 6E 61 6D 65 73 70 61 63 65
                22 3A 22 74 63 77 2E 64 6F 6D 61 69 6E 2E 61 76
                72 6F 2E 6A 61 76 61 22 2C 22 66 69 65 6C 64 73
                22 3A 5B 7B 22 6E 61 6D 65 22 3A 22 65 6D 70 6C
                6F 79 65 65 49 64 22 2C 22 74 79 70 65 22 3A 5B
                22 6C 6F 6E 67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C
                7B 22 6E 61 6D 65 22 3A 22 73 61 6C 65 72 79 22
                2C 22 74 79 70 65 22 3A 5B 22 64 6F 75 62 6C 65
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 63 6F 6E 73 75 6C 74 61 6E 74 22 2C
                22 74 79 70 65 22 3A 5B 22 62 6F 6F 6C 65 61 6E
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 65 6D 70 6C 6F 79 65 65 4E 61 6D 65
                22 2C 22 74 79 70 65 22 3A 5B 22 73 74 72 69 6E
                67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61
                6D 65 22 3A 22 64 65 70 61 72 74 6D 65 6E 74 73
                22 2C 22 74 79 70 65 22 3A 5B 22 6E 75 6C 6C 22
                2C 7B 22 74 79 70 65 22 3A 22 61 72 72 61 79 22
                2C 22 69 74 65 6D 73 22 3A 22 73 74 72 69 6E 67
                22 7D 5D 2C 22 64 65 66 61 75 6C 74 22 3A 6E 75
                6C 6C 7D 5D 7D 00 8D E0 B2 77 C3 D9 8F 00 65 0A
                70 A9 51 11 DF 9B 04 A8 01 00 86 A1 D8 9F EE 47
                00 B8 1E 85 EB 01 24 FE 40 00 01 00 10 4A 6F 68
                6E 20 44 6F 65 02 06 04 49 54 04 52 44 08 54 45
                43 48 00 00 86 A1 D8 9F EE 47 00 B8 1E 85 EB 01
                24 FE 40 00 01 00 10 4A 6F 68 6E 20 44 6F 65 02
                06 04 49 54 04 52 44 08 54 45 43 48 00 8D E0 B2
                77 C3 D9 8F 00 65 0A 70 A9 51 11 DF 9B
            </div>
        </section>
        <section>
            <h2>Protocol Buffers</h2>
        </section>

        <section>
            <h2>Protocol Buffers</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>Java,C/C++,Python</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Kode generering fra skjema</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>Required og optional felt</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>Binært</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Meget Bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Meget bra</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Lett å bruke god ytelse</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Installasjon og mangel på god maven støtte</td>
                </tr>
            </table>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##Litt mer om Protocol Buffers
                * Googles standard serialiserings verktøy
                * Utviklet spesielt med versjonering i tankene
                * NB! er ikke effektiv på repeated groups av ikke primitiver
            </script>
        </section>

        <section data-markdown>
            <script type="text/template">
                ##Kildekode generering
                * Opprett en *.proto (dsl) fil under src/main/proto
                * Installer Protocol Buffers (Kan være litt problemer med noen type Linux (Ubuntu))
                * protoc -I=$SRC_DIR --java_out=$DST_DIR $SRC_DIR/employee.proto
            </script>
        </section>
        <section>
            <h2>employee.proto</h2>
             <pre>
        <code data-trim class="proto">
package employees;

option java_package = "tcw.domain.protobuf";
option java_outer_classname = "EmployeeProto";

message Employee {
    optional int64 employeeId = 1;
    optional double salery = 2;
    optional bool consultant = 3;
    optional string employeeName = 4;
    repeated string departments = 5;
}
        </code>
    </pre>
        </section>

        <section>
            <h2>Domene Objekter</h2>
         <pre>
        <code data-trim class="java">
EmployeeProto.Employee.newBuilder()
    .setEmployeeId(1234567891011L)
    .setSalery(123456.12)
    .setConsultant(true)
    .setEmployeeName("John Doe")
.addAllDepartments(Lists.newArrayList("IT", "RD", "TECH")).build();
        </code>
    </pre>
        </section>
        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
byte[] bytes = objekt.toByteArray();
        </code>
    </pre>
                 <pre>
        <code data-trim class="java">
YtreObjekt.Objekt objekt;
objekt = YtreObjekt.Objekt.newBuilder().mergeFrom(bytes).build();
        </code>
    </pre>
        </section>

        <section>
            <h3>Protocol Buffers</h3>
            <h4>42 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                08 C3 90 EC 8F F7 23 11 B8 1E 85 EB 01 24 FE 40
                18 01 22 08 4A 6F 68 6E 20 44 6F 65 2A 02 49 54
                2A 02 52 44 2A 04 54 45 43 48
            </div>
        </section>

        <section>
            <h2>SBE</h2>
        </section>
        <section>
            <h2>SBE</h2>
            <table>
                <tr>
                    <td width="400">Språk</td>
                    <td>Java,C/C++,.Net</td>
                </tr>
                <tr>
                    <td>Bruk</td>
                    <td>Kode generering fra XML skjema</td>
                </tr>
                <tr>
                    <td>Versjonering</td>
                    <td>Required og optional felt</td>
                </tr>
                <tr>
                    <td>Format</td>
                    <td>Binært</td>
                </tr>
                <tr>
                    <td>Brukervennlighet</td>
                    <td>Lite Bra</td>
                </tr>
                <tr>
                    <td>Ytelse</td>
                    <td>Særdeles bra</td>
                </tr>
                <tr>
                    <td>Pluss</td>
                    <td>Ufattelig ytelse</td>
                </tr>
                <tr>
                    <td>Minus</td>
                    <td>Helt forferdelig å bruke</td>
                </tr>
            </table>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##Kildekode generering
                * Opprett en *.xml fil under src/main/sbe
                * Clone prosjektet fra github
                * Følge installasjonsinstrukser på github siden
                * java -Dsbe.output.dir=&lt;output dir&gt; -jar sbe.jar &lt;message-declarations-file.xml&gt;
            </script>
        </section>
        <section>
            <h2>employee.xml</h2>
             <pre>
        <code data-trim class="proto">
&lt;messageSchema package="tcw.domain.sbe"
id="1"
version="0"
semanticVersion="5.2"
description="JavaBin test"
byteOrder="littleEndian"&gt;

&lt;types&gt;
&lt;composite name="messageHeader" description="Message identifiers and length of message root"&gt;
&lt;type name="blockLength" primitiveType="uint16"/&gt;
&lt;type name="templateId" primitiveType="uint16"/&gt;
&lt;type name="schemaId" primitiveType="uint16"/&gt;
&lt;type name="version" primitiveType="uint16"/&gt;
&lt;/composite&gt;
&lt;composite name="varDataEncoding"&gt;
&lt;type name="length" primitiveType="uint8"/&gt;
&lt;type name="varData" primitiveType="uint8" length="0" characterEncoding="UTF-8"/&gt;
&lt;/composite&gt;
&lt;/types&gt;

&lt;types&gt;
&lt;enum name="BooleanType" encodingType="uint8"&gt;
&lt;validValue name="FALSE"&gt;0&lt;/validValue&gt;
&lt;validValue name="TRUE"&gt;1&lt;/validValue&gt;
&lt;/enum&gt;
&lt;/types&gt;

&lt;message name="Employee" id="1" description="Description of a basic Employee"&gt;
&lt;field name="employeeId" id="1" type="uint64"/&gt;
&lt;field name="salery" id="2" type="double"/&gt;
&lt;field name="consultant" id="3" type="BooleanType"/&gt;
&lt;data name="employeeName" id="4" type="varDataEncoding"/&gt;
&lt;data name="departmentA" id="5" type="varDataEncoding"/&gt;
&lt;data name="departmentB" id="6" type="varDataEncoding"/&gt;
&lt;data name="departmentC" id="7" type="varDataEncoding"/&gt;
&lt;/message&gt;

&lt;/messageSchema&gt;
        </code>
    </pre>
        </section>


        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                             <pre>
        <code data-trim class="java">
public class SbeSerializer {

private static final Employee EMPLOYEE_SBE = new Employee();
private static final MessageHeader MESSAGE_HEADER = new MessageHeader();
private static byte[] NAME;
private static byte[] DEPARTMENTA;
private static byte[] DEPARTMENTB;
private static byte[] DEPARTMENTC;
final ByteBuffer byteBuffer = ByteBuffer.allocateDirect(4096);
final DirectBuffer directBuffer = new DirectBuffer(byteBuffer);

static {
try {
NAME = "John Doe".getBytes(Employee.employeeNameCharacterEncoding());
DEPARTMENTA = "IT".getBytes(Employee.departmentACharacterEncoding());
DEPARTMENTB = "RD".getBytes(Employee.departmentBCharacterEncoding());
DEPARTMENTC = "TECH".getBytes(Employee.departmentCCharacterEncoding());
} catch (UnsupportedEncodingException e) {
e.printStackTrace();
}
}

public void serializeDeserialize() throws IOException {

final short messageTemplateVersion = 0;
int bufferOffset = 0;

MESSAGE_HEADER.wrap(directBuffer, bufferOffset, messageTemplateVersion)
.blockLength(EMPLOYEE_SBE.sbeBlockLength())
.templateId(EMPLOYEE_SBE.sbeTemplateId())
.schemaId(EMPLOYEE_SBE.sbeSchemaId())
.version(EMPLOYEE_SBE.sbeSchemaVersion());

bufferOffset += MESSAGE_HEADER.size();

encode(EMPLOYEE_SBE, directBuffer, bufferOffset);

bufferOffset = 0;
MESSAGE_HEADER.wrap(directBuffer, bufferOffset, messageTemplateVersion);

final int actingBlockLength = MESSAGE_HEADER.blockLength();
final int schemaId = MESSAGE_HEADER.schemaId();
final int actingVersion = MESSAGE_HEADER.version();

bufferOffset += MESSAGE_HEADER.size();

try {
decode(EMPLOYEE_SBE, directBuffer, bufferOffset, actingBlockLength, actingVersion);
} catch (Exception e) {
e.printStackTrace();
}
}

public static int encode(final Employee employee, final DirectBuffer directBuffer, final int bufferOffset) {
final int srcOffset = 0;
employee.wrapForEncode(directBuffer, bufferOffset)
.employeeId(12345)
.salery(123456.12)
.consultant(BooleanType.TRUE)
.putEmployeeName(NAME, srcOffset, NAME.length);
employee.putDepartmentA(DEPARTMENTA, srcOffset, DEPARTMENTA.length);
employee.putDepartmentB(DEPARTMENTB, srcOffset, DEPARTMENTB.length);
employee.putDepartmentC(DEPARTMENTC, srcOffset, DEPARTMENTC.length);
return employee.size();
}


public static void decode(final Employee employee,
final DirectBuffer directBuffer,
final int bufferOffset,
final int actingBlockLength,
final int actingVersion) throws Exception {
final byte[] buffer = new byte[128];
final StringBuilder sb = new StringBuilder();
employee.wrapForDecode(directBuffer, bufferOffset, actingBlockLength, actingVersion);
}
}

        </code>
    </pre>
        </section>
        <section>
            <h3>SBE</h3>
            <h4>Ikke resultat - Pga UNSAFE direkte lesing</h4>
        </section>
        <section>
            <h2>Benchmarks</h2>
        </section>
        <section>
            <div id="graph2" style="width: 900px; height: 700px;"></div>
        </section>
        <section>
            <div id="graph3" style="width: 900px; height: 700px;"></div>
        </section>
        <section>
            <div id="graph4" style="width: 900px; height: 700px;"></div>
        </section>
        <section>
        <h2>Konklusjon</h2>
        </section>

        <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Verktøy', '10 000 Objects'],
                ['Serializable',  58428],
                ['Externalizable',  39833,],
                ['Kryo',  47062],
                ['Jackson',  130697],
                ['Messagepack',  46933],
                ['Avro',  126322],
                ['Protocol buffers',  30066],
                ['SBE',  6646]
            ]);

            var options = {
                title: 'Benchmarks',
                vAxis: {title: 'Verktøy',  titleTextStyle: {color: 'red'}}
            };

            var chart = new google.visualization.BarChart(document.getElementById('graph2'));
            chart.draw(data, options);
        }
    </script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Verktøy', '100 000 Objects'],
                ['Serializable',  391595],
                ['Externalizable',  282253,],
                ['Kryo',  269675],
                ['Jackson',  532134],
                ['Messagepack',  241435],
                ['Avro',  340083],
                ['Protocol buffers',  121441],
                ['SBE',  12415]
            ]);

            var options = {
                title: 'Benchmarks',
                vAxis: {title: 'Verktøy',  titleTextStyle: {color: 'red'}}
            };

            var chart = new google.visualization.BarChart(document.getElementById('graph3'));
            chart.draw(data, options);
        }
    </script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Verktøy', '1 000 000 Objects'],
                ['Serializable',  6583342],
                ['Externalizable',  4771884,],
                ['Kryo',  3638694],
                ['Jackson',  6712376],
                ['Messagepack',  3941362],
                ['Avro',  5443522],
                ['Protocol buffers',  3842398],
                ['SBE',  107826]
            ]);

            var options = {
                title: 'Benchmarks',
                vAxis: {title: 'Verktøy',  titleTextStyle: {color: 'red'}}
            };

            var chart = new google.visualization.BarChart(document.getElementById('graph4'));
            chart.draw(data, options);
        }
    </script>

        <script>
            Reveal.initialize({
                transition: 'linear',
                backgroundTransition: 'slide',
                dependencies: [
                    // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
                    { src: 'bower_components/reveal.js/lib/js/classList.js', condition: function () {
                        return !document.body.classList;
                    } },

                    // Interpret Markdown in <section> elements
                    { src: 'bower_components/reveal.js/plugin/markdown/marked.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    } },
                    { src: 'bower_components/reveal.js/plugin/markdown/markdown.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    } },

                    // Syntax highlight for <code> elements
                    { src: 'bower_components/reveal.js/plugin/highlight/highlight.js',
                        async: true,
                        callback: function () {
                            hljs.initHighlightingOnLoad();
                        } },

                    // Zoom in and out with Alt+click
                    { src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function () {
                        return !!document.body.classList;
                    } }
                ]
            });
        </script>
</body>
</html>