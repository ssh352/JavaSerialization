<!doctype html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Serialisering av data - et løst problem?</title>
    <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.min.css">
    <link rel="stylesheet" href="bower_components/reveal.js/css/theme/moon.css" id="theme">

</head>
<body>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to
    improve your experience.</p>
<![endif]-->
<div class="reveal">
    <div class="slides">
        <section data-markdown>
            <script type="text/template">
                ##  Serialisering av data - et løst problem?
                Tom Chrisitian Woods
                Knowit Sør
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
                ## Oversikt
                * Hva er serialisering ?
                * Serialisering med Java
                    * Serializable
                    * Externalizable
                    * Versjonering
                    * Ytelse
                * Andre serialiserings bibliotek/verktøy
                    * Kryo
                    * Jackson
                    * Messagepack
                    * Avro
                    * Protocol Buffers
                    * SBE
                * Konklusjon
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
            ## Hva er serialisering ?
            </script>
        </section>
        <section>
            <h2>Serialisering</h2>
            <img src="img/test.svg" style="border-style: none">
        </section>
        <section data-markdown>
            <script type="text/template">
            ##Serialisering med Java
            </script>
        </section>
        <section>
            <h2>Serializable</h2>
    <pre>
        <code data-trim class="java">
            public class Employee implements Serializable {

            private static final long serialVersionUID = 1L;

            private long employeeId;
            private double salery;
            private boolean consultant;
            private String employeeName;
            private List&lt;String&gt; departments;
            ...

            }
        </code>
    </pre>
        </section>

        <section>
            <h2>Serializable</h2>
                <pre>
        <code data-trim class="java">
            private void writeObject(ObjectOutputStream stream) throws IOException;
        </code>
    </pre>
    <pre>
        <code data-trim class="java">
            private void readObject(ObjectInputStream stream)throws IOException,
                                             ClassNotFoundException;
        </code>
    </pre>
        </section>
        <section>
            <h2>Custom writeObject/readObject</h2>
    <pre>
        <code data-trim class="java">
private String name;
private transient String note;

private void writeObject(ObjectOutputStream out) throws IOException {
out.defaultWriteObject();
out.writeObject(this.note);
}

private void readObject(ObjectInputStream in) throws IOException,
                                          ClassNotFoundException {
in.defaultReadObject();
this.note = (String) in.readObject();
}
        </code>
    </pre>
        </section>

        <section>
            <h2>Kode for å serialisere/deserialisere</h2>
                <pre>
        <code data-trim class="java">
public &lt;T extends Serializable&gt; byte[] serialize(T t) throws IOException {
  try (ByteArrayOutputStream bos = new ByteArrayOutputStream()){
    try (ObjectOutputStream os = new ObjectOutputStream(bos)){
        os.writeObject(t);
    }
    return bos.toByteArray();
  }
}
        </code>
    </pre>

                 <pre>
        <code data-trim class="java">
public &lt;T&gt; T deserialize(byte[] bytes,Class&lt;T&gt; clazz) throws
                                IOException, ClassNotFoundException {
  try ( ByteArrayInputStream bis = new ByteArrayInputStream(bytes)){
    try (ObjectInputStream objectInputStream = new ObjectInputStream(bis)){
        return clazz.cast(objectInputStream.readObject());
    }
  }
}
        </code>
    </pre>
        </section>
<section data-markdown>
    <script type="text/template">
        ## Hva skjer når writeObject blir kalt
        * Objectet må selv ha eller arve fra et Object som
            * Implementer serializable
            * Har en tilgjengelig tom konstuktør
        * writeObject blir kalt rekursivt fra løvnode til høyest forelder som fyller kriterene for å være serialiserbar
        * Alle felt som er ikke transient eller static blir tatt med
        * Hvis ikke Objectet/ene har serialVersionUID blir denne 64-bits hashen kalkulert
        * NB! Bruker Refleksjon
    </script>
</section>

        <section>
            <h2>Externalizable</h2>
    <pre>
        <code data-trim class="java">
            public class Employee implements Externalizable {

            private static final long serialVersionUID = 1L;

            private long employeeId;
            private double salery;
            private boolean consultant;
            private String employeeName;
            private List&lt;String&gt; departments;
            ...
        </code>
    </pre>

        </section>
        <section>
            <h2>Externalizable</h2>
                <pre>
        <code data-trim class="java">
            public void writeExternal(ObjectOutput out) throws IOException {
            out.writeLong(employeeId);
            out.writeDouble(salery);
            out.writeBoolean(consultant);
            out.writeObject(employeeName);
            out.writeObject(departments);
            }
        </code>
    </pre>
    <pre>
        <code data-trim class="java">
            public void readExternal(ObjectInput in) throws IOException,
            ClassNotFoundException {
            employeeId = in.readLong();
            salery = in.readDouble();
            consultant = in.readBoolean();
            employeeName = (String) in.readObject();
            departments = (List&lt;String&gt;) in.readObject();
            }
        </code>
    </pre>
        </section>
        <section data-markdown>
            <script type="text/template">
            ## Versjonering
            </script>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##  Ikke brytende endringer
                * Legge til felt
                * Legge til klasse
                * Fjerne klasse
                * Legge til writeObject/readObject
                * Legge til java.io.Serializable
                * Endre felt tilgang (public, package, protected og private)
                * Endre et felt fra static til nonstatic eller transient til nontransient
            </script>
        </section>
        <section>
            <h2>Ytelse</h2>
        </section>
        <section data-markdown>
            <script type="text/template">
                ##  Benchmarking
                * Hvilken type data (stor vs lite objekt graf)
                * Innholder collection typer
                * Ekvivalent representasjon (Versjon data osv.)
                * GC forurensing (Java)
                * Ulike optimaliseringer
            </script>
        </section>

        <section>
            <h2>TEST DATA</h2>
                <pre>
        <code data-trim class="java">
long employeeId = 1234567891011; <- inc 1
double salery = 123456.12;
boolean consultant = true;
String employeeName = "John Doe";
List&lt;String&gt; departments = ["IT", "RD", "TECH"];
        </code>
    </pre>
    </section>
        <section>
            <h3>Serializable</h3>
            <h4>243 bytes</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 73 72 00 13 74 63 77 2E 64 6F 6D 61
            69 6E 2E 45 6D 70 6C 6F 79 65 65 00 00 00 00 00
            00 00 01 02 00 05 5A 00 0A 63 6F 6E 73 75 6C 74
            61 6E 74 4A 00 0A 65 6D 70 6C 6F 79 65 65 49 64
            44 00 06 73 61 6C 65 72 79 4C 00 0B 64 65 70 61
            72 74 6D 65 6E 74 73 74 00 10 4C 6A 61 76 61 2F
            75 74 69 6C 2F 4C 69 73 74 3B 4C 00 0C 65 6D 70
            6C 6F 79 65 65 4E 61 6D 65 74 00 12 4C 6A 61 76
            61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3B 78 70
            01 00 00 01 1F 71 FB 08 43 40 FE 24 01 EB 85 1E
            B8 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E 41
            72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61 9D
            03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00 03
            77 04 00 00 00 03 74 00 02 49 54 74 00 02 52 44
            74 00 04 54 45 43 48 78 74 00 08 4A 6F 68 6E 20
            44 6F 65
            </div>
        </section>

        <section>
            <h3>Serializable</h3>
            <h4>303 bytes - men bare 60 nye</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 73 72 00 13 74 63 77 2E 64 6F 6D 61
            69 6E 2E 45 6D 70 6C 6F 79 65 65 00 00 00 00 00
            00 00 01 02 00 05 5A 00 0A 63 6F 6E 73 75 6C 74
            61 6E 74 4A 00 0A 65 6D 70 6C 6F 79 65 65 49 64
            44 00 06 73 61 6C 65 72 79 4C 00 0B 64 65 70 61
            72 74 6D 65 6E 74 73 74 00 10 4C 6A 61 76 61 2F
            75 74 69 6C 2F 4C 69 73 74 3B 4C 00 0C 65 6D 70
            6C 6F 79 65 65 4E 61 6D 65 74 00 12 4C 6A 61 76
            61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3B 78 70
            01 00 00 01 1F 71 FB 08 43 40 FE 24 01 EB 85 1E
            B8 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E 41
            72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61 9D
            03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00 03
            77 04 00 00 00 03 74 00 02 49 54 74 00 02 52 44
            74 00 04 54 45 43 48 78 74 00 08 4A 6F 68 6E 20
            44 6F 65 <span style="color: red">73 71 00 7E 00 00 01 00 00 01 1F 71 FB
            08 44 40 FE 24 01 EB 85 1E B8 73 71 00 7E 00 04
            00 00 00 03 77 04 00 00 00 03 71 00 7E 00 06 71
            00 7E 00 07 71 00 7E 00 08 78 71 00 7E 00 09</span>
            </div>
        </section>

        <section>
            <h3>Externalizable</h3>
            <h4>105 bytes</h4>
            <div style="text-align: left;color: #f5e810">
            AC ED 00 05 77 11 00 00 01 1F 71 FB 08 43 40 FE
            24 01 EB 85 1E B8 01 74 00 08 4A 6F 68 6E 20 44
            6F 65 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E
            41 72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61
            9D 03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00
            03 77 04 00 00 00 03 74 00 02 49 54 74 00 02 52
            44 74 00 04 54 45 43 48 78
        </div>
        </section>
        <section>
            <h3>Externalizable</h3>
            <h4>161 bytes - men bare 56 nye</h4>
            <div style="text-align: left;color: #f5e810">
                AC ED 00 05 77 11 00 00 01 1F 71 FB 08 43 40 FE
                24 01 EB 85 1E B8 01 74 00 08 4A 6F 68 6E 20 44
                6F 65 73 72 00 13 6A 61 76 61 2E 75 74 69 6C 2E
                41 72 72 61 79 4C 69 73 74 78 81 D2 1D 99 C7 61
                9D 03 00 01 49 00 04 73 69 7A 65 78 70 00 00 00
                03 77 04 00 00 00 03 74 00 02 49 54 74 00 02 52
                44 74 00 04 54 45 43 48 78 <span style="color: red">77 11 00 00 01 1F 71
                FB 08 44 40 FE 24 01 EB 85 1E B8 01 71 00 7E 00
                00 73 71 00 7E 00 01 00 00 00 03 77 04 00 00 00
                03 71 00 7E 00 03 71 00 7E 00 04 71 00 7E 00 05
                78
                </span>
            </div>
        </section>
        <section>
            <h2>Kryo</h2>
        </section>
        <section>
            <h3>Kryo</h3>
            <h4>59 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                01 01 01 00 6A 61 76 61 2E 75 74 69 6C 2E 41 72
                72 61 79 4C 69 73 F4 01 03 01 49 D4 01 52 C4 01
                54 45 43 C8 86 A1 D8 9F EE 47 01 4A 6F 68 6E 20
                44 6F E5 40 FE 24 01 EB 85 1E B8
            </div>
        </section>
        <section>
            <h2>Jackson</h2>
        </section>
        <section>
            <h3>Jackson</h3>
            <h4>124 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                7B 22 65 6D 70 6C 6F 79 65 65 49 64 22 3A 31 32
                33 34 35 36 37 38 39 31 30 31 31 2C 22 73 61 6C
                65 72 79 22 3A 31 32 33 34 35 36 2E 31 32 2C 22
                63 6F 6E 73 75 6C 74 61 6E 74 22 3A 74 72 75 65
                2C 22 65 6D 70 6C 6F 79 65 65 4E 61 6D 65 22 3A
                22 4A 6F 68 6E 20 44 6F 65 22 2C 22 64 65 70 61
                72 74 6D 65 6E 74 73 22 3A 5B 22 49 54 22 2C 22
                52 44 22 2C 22 54 45 43 48 22 5D 7D
            </div>
        </section>
        <section>
            <h2>Messagepack</h2>
        </section>
        <section>
            <h3>Messagepack</h3>
            <h4>40 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                CF 00 00 01 1F 71 FB 08 43 CB 40 FE 24 01 EB 85
                1E B8 C3 A8 4A 6F 68 6E 20 44 6F 65 93 A2 49 54
                A2 52 44 A4 54 45 43 48
            </div>
        </section>
        <section>
            <h2>Avro</h2>
        </section>
        <section>
            <h3>Avro</h3>
            <h4>450 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                4F 62 6A 01 02 16 61 76 72 6F 2E 73 63 68 65 6D
                61 C4 05 7B 22 74 79 70 65 22 3A 22 72 65 63 6F
                72 64 22 2C 22 6E 61 6D 65 22 3A 22 45 6D 70 6C
                6F 79 65 65 22 2C 22 6E 61 6D 65 73 70 61 63 65
                22 3A 22 74 63 77 2E 64 6F 6D 61 69 6E 2E 61 76
                72 6F 2E 6A 61 76 61 22 2C 22 66 69 65 6C 64 73
                22 3A 5B 7B 22 6E 61 6D 65 22 3A 22 65 6D 70 6C
                6F 79 65 65 49 64 22 2C 22 74 79 70 65 22 3A 5B
                22 6C 6F 6E 67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C
                7B 22 6E 61 6D 65 22 3A 22 73 61 6C 65 72 79 22
                2C 22 74 79 70 65 22 3A 5B 22 64 6F 75 62 6C 65
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 63 6F 6E 73 75 6C 74 61 6E 74 22 2C
                22 74 79 70 65 22 3A 5B 22 62 6F 6F 6C 65 61 6E
                22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61 6D
                65 22 3A 22 65 6D 70 6C 6F 79 65 65 4E 61 6D 65
                22 2C 22 74 79 70 65 22 3A 5B 22 73 74 72 69 6E
                67 22 2C 22 6E 75 6C 6C 22 5D 7D 2C 7B 22 6E 61
                6D 65 22 3A 22 64 65 70 61 72 74 6D 65 6E 74 73
                22 2C 22 74 79 70 65 22 3A 5B 22 6E 75 6C 6C 22
                2C 7B 22 74 79 70 65 22 3A 22 61 72 72 61 79 22
                2C 22 69 74 65 6D 73 22 3A 22 73 74 72 69 6E 67
                22 7D 5D 2C 22 64 65 66 61 75 6C 74 22 3A 6E 75
                6C 6C 7D 5D 7D 00 D8 DB 56 32 A1 95 ED F0 6A 5A
                6E 6D A8 C5 6C C0 02 54 00 86 A1 D8 9F EE 47 00
                B8 1E 85 EB 01 24 FE 40 00 01 00 10 4A 6F 68 6E
                20 44 6F 65 02 06 04 49 54 04 52 44 08 54 45 43
                48 00 D8 DB 56 32 A1 95 ED F0 6A 5A 6E 6D A8 C5
                6C C0
            </div>
        </section>
        <section>
            <h2>Protocol Buffers</h2>
        </section>
        <section>
            <h3>Protocol Buffers</h3>
            <h4>42 bytes</h4>
            <div style="text-align: left;color: #f5e810">
                08 C3 90 EC 8F F7 23 11 B8 1E 85 EB 01 24 FE 40
                18 01 22 08 4A 6F 68 6E 20 44 6F 65 2A 02 49 54
                2A 02 52 44 2A 04 54 45 43 48
            </div>
        </section>
        <section>
            <h2>SBE</h2>
        </section>
        <section>
            <h3>SBE</h3>
            <h4>Ikke resultat - Pga UNSAFE direkte lesing</h4>
        </section>
        <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.min.js"></script>

        <script>
            Reveal.initialize({
                transition: 'linear',
                backgroundTransition: 'slide',
                dependencies: [
                    // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
                    { src: 'bower_components/reveal.js/lib/js/classList.js', condition: function () {
                        return !document.body.classList;
                    } },

                    // Interpret Markdown in <section> elements
                    { src: 'bower_components/reveal.js/plugin/markdown/marked.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    } },
                    { src: 'bower_components/reveal.js/plugin/markdown/markdown.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    } },

                    // Syntax highlight for <code> elements
                    { src: 'bower_components/reveal.js/plugin/highlight/highlight.js',
                        async: true,
                        callback: function () {
                            hljs.initHighlightingOnLoad();
                        } },

                    // Zoom in and out with Alt+click
                    { src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function () {
                        return !!document.body.classList;
                    } }
                ]
            });
        </script>
</body>
</html>